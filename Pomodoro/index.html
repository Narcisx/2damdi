<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pomodoro ‚Äî App de descanso</title>
  <style>
    :root{
      --bg:#0f1724; /* dark */
      --card:#0b1220;
      --accent:#ff6b6b;
      --accent-2:#7c5cff;
      --muted:#9aa4b2;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,#071223 0%, var(--bg) 100%); color:#e6eef6}
    .app{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
    .card{
      width:980px;
      max-width:100%;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;
      padding:24px;
      display:grid;
      grid-template-columns:360px 1fr;
      gap:20px;
      box-shadow:0 8px 30px rgba(2,6,23,0.7);
      position: relative; /* Para posicionar el bot√≥n de hamburguesa */
    }

    /* Left panel (timer) */
    .left{display:flex;flex-direction:column;align-items:center;gap:18px;padding:20px;border-radius:12px;background:var(--glass)}
    .mode-controls{display:flex;gap:10px}
    .mode-btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:10px;color:var(--muted);cursor:pointer}
    .mode-btn.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;border:0}

    .ring{width:260px;height:260px;display:grid;place-items:center}
    .time{font-size:48px;font-weight:700;letter-spacing:1px}
    .label{color:var(--muted);font-size:13px;margin-top:6px}

    .controls{display:flex;gap:10px}
    .btn{padding:10px 16px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .btn.start{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white}
    .btn.pause{background:#263042;color:white}
    .btn.reset{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    /* Right panel (settings & history) */
    .right{display:flex;flex-direction:column;gap:16px;padding:18px}
    .section{background:rgba(255,255,255,0.02);padding:14px;border-radius:10px}
    .section h3{margin:0 0 8px 0;font-size:15px}
    .field{display:flex;gap:8px;align-items:center}
    .field label{min-width:160px;color:var(--muted);font-size:13px}
    .field input[type=number]{width:100px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .toggle{display:inline-flex;align-items:center;gap:8px}

    .small{font-size:13px;color:var(--muted)}
    .history{display:flex;flex-direction:column;gap:8px}
    .hist-item{display:flex;justify-content:space-between;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);font-size:13px}

    footer{font-size:12px;color:var(--muted);text-align:center;margin-top:10px}

    /* --- ESTILOS PARA MEN√ö M√ìVIL (A√ëADIDO) --- */
    .hamburger-btn, .close-btn { display: none; }

    /* responsive */
    @media (max-width: 880px){
      .app { padding: 0; }
      .card{
        grid-template-columns:1fr;
        height: 100vh;
        border-radius: 0;
        padding: 16px;
        gap: 0;
      }
      .left{
        justify-content: center; /* Centra el contenido del reloj */
        background: transparent;
      }

      /* Bot√≥n de Hamburguesa */
      .hamburger-btn {
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        width: 30px;
        height: 30px;
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 0;
        position: absolute;
        top: 24px;
        left: 24px;
        z-index: 1001;
      }
      .hamburger-btn span {
        width: 30px;
        height: 3px;
        background: var(--muted);
        border-radius: 5px;
      }

      /* Panel lateral que se desliza */
      .right{
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        width: 300px;
        max-width: 80%;
        background: var(--card);
        z-index: 1000;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 5px 0px 20px rgba(0,0,0,0.3);
        overflow-y: auto; /* Para permitir scroll si el contenido es largo */
        padding-top: 60px; /* Espacio para el bot√≥n de cerrar */
      }
      .right.menu-open {
        transform: translateX(0);
      }

      /* Bot√≥n de cerrar */
      .close-btn {
        display: block;
        position: absolute;
        top: 15px;
        right: 15px;
        background: transparent;
        border: none;
        color: white;
        font-size: 32px;
        cursor: pointer;
      }
    }


    /* CSS para el Ayudante de Enfoque */
    .motivator { display: flex; align-items: center; gap: 15px; margin-top: 10px; }
    .character {
        width: 60px; height: 60px; background: linear-gradient(45deg, var(--accent-2), #a18aff);
        border-radius: 50%; position: relative; cursor: pointer;
        flex-shrink: 0; transition: transform 0.2s ease;
        animation: float 3s ease-in-out infinite;
    }
    .character:hover { transform: scale(1.1) translateY(-5px); }
    .eye { 
      width: 6px; height: 8px; background: white; border-radius: 50%; position: absolute; top: 22px; 
      animation: blink 4s ease-in-out infinite;
    }
    .left-eye { left: 18px; }
    .right-eye { right: 18px; }
    .mouth { 
      width: 15px; height: 7px; border: 2px solid white; border-top: none; border-radius: 0 0 10px 10px; 
      position: absolute; bottom: 15px; left: calc(50% - 7.5px); 
    }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    @keyframes blink { 0%, 90%, 100% { transform: scaleY(1); } 95% { transform: scaleY(0.1); } }

    .quote-bubble {
        flex: 1; background: rgba(255, 255, 255, 0.04); padding: 12px;
        border-radius: 10px; position: relative;
    }
    .quote-bubble p { margin: 0; font-size: 13px; font-style: italic; color: var(--muted); }
    .quote-bubble::before {
        content: ''; position: absolute; top: 50%; left: -10px; margin-top: -5px; 
        border-width: 5px; border-style: solid;
        border-color: transparent rgba(255, 255, 255, 0.04) transparent transparent;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card" role="application" aria-label="Timer Pomodoro">
      <button class="hamburger-btn" id="hamburgerBtn" aria-label="Abrir men√∫">
        <span></span><span></span><span></span>
      </button>

      <div class="left">
        <div class="mode-controls" role="tablist">
          <button class="mode-btn active" data-mode="pomodoro" role="tab">Pomodoro</button>
          <button class="mode-btn" data-mode="short" role="tab">Descanso corto</button>
          <button class="mode-btn" data-mode="long" role="tab">Descanso largo</button>
        </div>
        <div class="ring" aria-hidden="false">
          <svg id="progressSvg" viewBox="0 0 120 120" width="260" height="260">
            <defs>
              <linearGradient id="g1" x1="0%" x2="100%"><stop offset="0%" stop-color="var(--accent)" /><stop offset="100%" stop-color="var(--accent-2)" /></linearGradient>
            </defs>
            <g transform="translate(60,60)">
              <circle r="52" stroke="rgba(255,255,255,0.06)" stroke-width="12" fill="none"></circle>
              <circle id="progressCircle" r="52" stroke="url(#g1)" stroke-width="12" stroke-linecap="round" fill="none" stroke-dasharray="326.7256" stroke-dashoffset="0" transform="rotate(-90)"></circle>
            </g>
          </svg>
          <div style="position:absolute;text-align:center;">
            <div class="time" id="timeDisplay">25:00</div>
            <div class="label" id="modeLabel">Enfoque</div>
          </div>
        </div>
        <div class="controls">
          <button class="btn start" id="startBtn">Iniciar</button>
          <button class="btn pause" id="pauseBtn" style="display:none">Pausar</button>
          <button class="btn reset" id="resetBtn">Reiniciar</button>
        </div>
        <div class="small">Atajos: <strong>Space</strong> iniciar/pausar ‚Ä¢ <strong>R</strong> reiniciar</div>
      </div>

      <div class="right" id="rightPanel">
        <button class="close-btn" id="closeMenuBtn" aria-label="Cerrar men√∫">&times;</button>

        <div class="section">
          <h3>Configuraci√≥n</h3>
          <div class="field"><label for="pomodoroInput">Duraci√≥n Pomodoro (min)</label><input id="pomodoroInput" type="number" min="1" max="180" value="25"></div>
          <div class="field"><label for="shortInput">Descanso corto (min)</label><input id="shortInput" type="number" min="1" max="60" value="5"></div>
          <div class="field"><label for="longInput">Descanso largo (min)</label><input id="longInput" type="number" min="1" max="120" value="15"></div>
          <div class="field"><label for="cyclesInput">Ciclos hasta descanso largo</label><input id="cyclesInput" type="number" min="1" max="10" value="4"></div>
          <div style="margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap: wrap;">
            <label class="toggle"><input type="checkbox" id="autoNext"> <span class="small">Autoplay siguiente</span></label>
            <label class="toggle"><input type="checkbox" id="soundToggle" checked> <span class="small">Sonido al acabar</span></label>
            <label class="toggle"><input type="checkbox" id="notifToggle"> <span class="small">Notificaciones</span></label>
          </div>
          <div style="margin-top:10px;display:flex;gap:8px;"><button class="btn" id="saveSettings">Guardar</button><button class="btn" id="resetSettings">Restablecer</button></div>
        </div>
        <div class="section">
          <h3>Tu Ayudante de Enfoque</h3>
          <div class="motivator">
            <div class="character" id="motivatorCharacter" title="¬°Haz clic para otra frase!"><div class="eye left-eye"></div><div class="eye right-eye"></div><div class="mouth"></div></div>
            <div class="quote-bubble"><p id="motivatorQuote">¬°Hagamos que cada segundo cuente!</p></div>
          </div>
        </div>
        <div class="section">
          <h3>Historial</h3>
          <div class="history" id="history"></div>
        </div>
        <div class="section">
          <h3>Consejos r√°pidos</h3>
          <ul class="small">
            <li>Trabaja en bloques y toma descansos breves para mantener la concentraci√≥n.</li>
            <li>Lev√°ntate y estira durante los descansos para mejorar la circulaci√≥n.</li>
            <li>Si necesitas m√°s tiempo, ajusta la duraci√≥n en configuraci√≥n.</li>
          </ul>
        </div>
        <footer>@Copyright Germ√°n Narciso C√≥rdoba</footer>
      </div>
    </div>
  </div>
  
  <audio id="beep" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=" preload="auto"></audio>

 <script>
    // --- Elementos ---
    const timeDisplay = document.getElementById('timeDisplay');
    const modeLabel = document.getElementById('modeLabel');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const modeBtns = document.querySelectorAll('.mode-btn');
    const progressCircle = document.getElementById('progressCircle');
    const beep = document.getElementById('beep');
    const historyEl = document.getElementById('history');

    // --- Config inputs ---
    const pomodoroInput = document.getElementById('pomodoroInput');
    const shortInput = document.getElementById('shortInput');
    const longInput = document.getElementById('longInput');
    const cyclesInput = document.getElementById('cyclesInput');
    const autoNext = document.getElementById('autoNext');
    const soundToggle = document.getElementById('soundToggle');
    const notifToggle = document.getElementById('notifToggle');
    const saveSettings = document.getElementById('saveSettings');
    const resetSettings = document.getElementById('resetSettings');

    // --- Ayudante Motivacional ---
    const motivatorCharacter = document.getElementById('motivatorCharacter');
    const motivatorQuote = document.getElementById('motivatorQuote');
    
    // --- L√≥gica para Men√∫ M√≥vil ---
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const closeMenuBtn = document.getElementById('closeMenuBtn');
    const rightPanel = document.getElementById('rightPanel');

    hamburgerBtn.addEventListener('click', () => rightPanel.classList.add('menu-open'));
    closeMenuBtn.addEventListener('click', () => rightPanel.classList.remove('menu-open'));

    // --- Estado ---
    let mode = 'pomodoro';
    let running = false;
    let timer = null;
    let remaining = 25*60;
    let total = remaining;
    let completedCycles = 0;
    const CIRCLE_CIRC = 2*Math.PI*52;

    const motivationalPhrases = [
      "¬°Un peque√±o paso hoy es un gran salto ma√±ana!", "La concentraci√≥n es la clave del √©xito. ¬°T√∫ puedes!",
      "Cada pomodoro completado te acerca a tu meta.", "El descanso es parte del trabajo. ¬°Recarga energ√≠as!",
      "¬°Sigue adelante! El esfuerzo vale la pena.", "La disciplina es el puente entre tus metas y tus logros.",
      "Hecho es mejor que perfecto. ¬°No te detengas!", "Convierte los obst√°culos en oportunidades.",
      "Cree en ti mismo y en todo lo que eres.", "La clave es empezar, incluso si es con algo peque√±o."
    ];

    function showNewQuote() {
      const randomIndex = Math.floor(Math.random() * motivationalPhrases.length);
      motivatorQuote.textContent = motivationalPhrases[randomIndex];
    }

    function loadSettings(){
      const s = JSON.parse(localStorage.getItem('pomodoro.settings') || '{}');
      if(s.pomodoro) pomodoroInput.value = s.pomodoro;
      if(s.short) shortInput.value = s.short;
      if(s.long) longInput.value = s.long;
      if(s.cycles) cyclesInput.value = s.cycles;
      autoNext.checked = s.autoNext ?? true;
      soundToggle.checked = s.sound ?? true;
      notifToggle.checked = s.notif ?? false;
      const hist = JSON.parse(localStorage.getItem('pomodoro.history') || '[]');
      renderHistory(hist);
    }

    function saveSettingsToStorage(){
      const s = {
        pomodoro: Number(pomodoroInput.value), short: Number(shortInput.value), long: Number(longInput.value),
        cycles: Number(cyclesInput.value), autoNext: autoNext.checked, sound: soundToggle.checked, noti: notifToggle.checked
      };
      localStorage.setItem('pomodoro.settings', JSON.stringify(s));
    }

    function formatTime(sec){
      const m = Math.floor(sec/60).toString().padStart(2,'0');
      const s = (sec%60).toString().padStart(2,'0');
      return `${m}:${s}`;
    }

    function updateDisplay(){
      timeDisplay.textContent = formatTime(remaining);
      const percent = (total - remaining) / total;
      const dash = CIRCLE_CIRC * (1 - percent);
      progressCircle.style.strokeDasharray = `${CIRCLE_CIRC}`;
      progressCircle.style.strokeDashoffset = dash;
    }

    function setMode(newMode, resetTimer=true){
      mode = newMode;
      document.querySelectorAll('.mode-btn').forEach(b=>b.classList.toggle('active', b.dataset.mode===mode));
      if(mode==='pomodoro'){ total = Number(pomodoroInput.value)*60; modeLabel.textContent = 'Enfoque';
      } else if(mode==='short'){ total = Number(shortInput.value)*60; modeLabel.textContent = 'Descanso corto';
      } else { total = Number(longInput.value)*60; modeLabel.textContent = 'Descanso largo'; }
      if(resetTimer) remaining = total;
      updateDisplay();
    }

    function tick(){
      if(remaining<=0){ clearInterval(timer); timer=null; running=false; onFinish(); return; }
      remaining--;
      updateDisplay();
    }

    function onFinish(){
      playSound();
      addHistoryEntry(mode, 'completado');

      // ===== SECCI√ìN DE NOTIFICACIONES MODIFICADA =====
      // Solo intenta enviar una notificaci√≥n si la opci√≥n est√° activa y el permiso fue concedido.
      if (notifToggle.checked && "Notification" in window && Notification.permission === 'granted') {
        let title = '';
        let msg = '';
        
        // Personaliza el mensaje seg√∫n el modo actual
        if (mode === 'pomodoro') {
            title = '¬°Tiempo de descansar! üßò';
            msg = 'Has completado un Pomodoro. ¬°Buen trabajo! T√≥mate un respiro.';
        } else { // Para descansos cortos y largos
            title = '¬°A trabajar! üí™';
            msg = 'El descanso ha terminado. Es hora de volver a concentrarse.';
        }
        
        // Crea y muestra la notificaci√≥n con un icono
        new Notification(title, {
            body: msg,
            icon: 'https://img.icons8.com/plasticine/100/tomato.png'
        });
      }
      // ===== FIN DE LA SECCI√ìN MODIFICADA =====

      if(mode==='pomodoro'){ completedCycles++; }
      const cyclesToLong = Number(cyclesInput.value);
      if(autoNext.checked){
        if(mode==='pomodoro'){
          if(completedCycles % cyclesToLong === 0){ setMode('long'); } else { setMode('short'); }
          startTimer();
        } else { setMode('pomodoro'); startTimer(); }
      } else { startBtn.style.display='inline-block'; pauseBtn.style.display='none'; }
    }

    function startTimer(){
      if(running) return;
      running = true;
      addHistoryEntry(mode, 'iniciado');
      showNewQuote();
      if(!timer) timer = setInterval(tick,1000);
      startBtn.style.display='none';
      pauseBtn.style.display='inline-block';
    }

    function pauseTimer(){
      running=false; clearInterval(timer); timer=null;
      addHistoryEntry(mode, 'pausado');
      startBtn.style.display='inline-block';
      pauseBtn.style.display='none';
    }

    function resetTimer(){
      running = false; clearInterval(timer); timer = null;
      setMode(mode, true);
      addHistoryEntry(mode, 'reiniciado');
      startBtn.style.display = 'inline-block';
      pauseBtn.style.display = 'none';
    }

    function playSound(){
      if(!soundToggle.checked) return;
      try{ beep.currentTime=0; beep.play(); }catch(e){}
    }

    function addHistoryEntry(mode, action){
      const hist = JSON.parse(localStorage.getItem('pomodoro.history') || '[]');
      hist.unshift({mode, action, time: new Date().toISOString()});
      if(hist.length>20) hist.pop();
      localStorage.setItem('pomodoro.history', JSON.stringify(hist));
      renderHistory(hist);
    }

    function renderHistory(hist){
      historyEl.innerHTML='';
      hist.forEach(h=>{
        const d = new Date(h.time);
        const el = document.createElement('div');
        el.className='hist-item';
        let modeText = '';
        switch(h.mode){
            case 'pomodoro': modeText = 'Pomodoro'; break;
            case 'short': modeText = 'Descanso Corto'; break;
            case 'long': modeText = 'Descanso Largo'; break;
            default: modeText = h.mode;
        }
        const actionText = h.action ? h.action.charAt(0).toUpperCase() + h.action.slice(1) : '';
        el.innerHTML = `<div>${modeText} - <strong>${actionText}</strong></div><div class="small">${d.toLocaleString()}</div>`;
        historyEl.appendChild(el);
      });
    }

    // --- Eventos UI ---
    modeBtns.forEach(b=>b.addEventListener('click', ()=>{ setMode(b.dataset.mode); }));
    startBtn.addEventListener('click', startTimer);
    pauseBtn.addEventListener('click', pauseTimer);
    resetBtn.addEventListener('click', resetTimer);
    saveSettings.addEventListener('click', ()=>{ saveSettingsToStorage(); alert('Configuraci√≥n guardada'); });
    resetSettings.addEventListener('click', ()=>{ 
      localStorage.removeItem('pomodoro.settings'); 
      localStorage.removeItem('pomodoro.history');
      location.reload(); 
    });
    motivatorCharacter.addEventListener('click', showNewQuote);

    // --- Keyboard shortcuts ---
    document.addEventListener('keydown', (e)=>{
      if(e.code==='Space'){ e.preventDefault(); running? pauseTimer(): startTimer(); }
      if(e.key.toLowerCase()==='r') resetTimer();
    });

    // --- Persist inputs live ---
    [pomodoroInput, shortInput, longInput, cyclesInput, autoNext, soundToggle, notifToggle].forEach(inp=>{
      inp.addEventListener('change', ()=>{ saveSettingsToStorage(); setMode(mode,false); });
    });

    // --- Init ---
    loadSettings();
    setMode('pomodoro');
    showNewQuote();

    // Pide permiso para las notificaciones SOLO cuando el usuario activa la opci√≥n
    notifToggle.addEventListener('change', ()=>{
      if(notifToggle.checked && "Notification" in window && Notification.permission !== 'granted'){
        // El navegador se encargar√° de no volver a preguntar si el usuario ya las ha denegado.
        Notification.requestPermission();
      }
    });
    
    startBtn.focus();
  </script>
</body>
</html>